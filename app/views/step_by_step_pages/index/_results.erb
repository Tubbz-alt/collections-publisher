<%= GovukPublishingComponents::AppHelpers::TableHelper.helper(self, "Documents list", { sortable: true, caption_classes: "govuk-visually-hidden" }) do |t| %>

  <%= t.head do %>
    <%= t.header "Title" %>
    <%= t.header "Status" %>
    <%= t.header "Last updated" %>
  <% end %>

  <%= t.body do %>
    <% @step_by_step_pages.each do |step_by_step_page| %>

      <% preview_link = capture do %>
        <% if step_by_step_page.has_draft? %>
          <%= link_to "/#{step_by_step_page.slug}", preview_url(step_by_step_page.slug, auth_bypass_id: step_by_step_page.auth_bypass_id), target: "_blank", class: "govuk-link" %>
        <% elsif step_by_step_page.status.published? %>
          <%= link_to "/#{step_by_step_page.slug}", published_url(step_by_step_page.slug), target: "_blank", class: "govuk-link" %>
        <% else %>
          /<%= step_by_step_page.slug %>
        <% end %>
      <% end %>

      <%= t.row do %>
        <%= t.cell render "govuk_publishing_components/components/document_list", {
          items: [
            {
              link: {
                text: step_by_step_page.title,
                path: step_by_step_page
              },
              metadata: {
                preview_link: preview_link
              }
            }
          ]
        } %>

        <%= t.cell step_by_step_page.status.humanize %>
        <%= t.cell step_by_step_page.created_at.strftime('%-d %B %Y') %>
      <% end %>
    <% end %>
  <% end %>
<% end %>
