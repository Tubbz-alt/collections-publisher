<%
  links = [
    {
      text: 'Step by step publisher',
      href: step_by_step_pages_path
    },
    {
      text: @step_by_step_page.title,
      href: @step_by_step_page
    },
    {
      text: 'Change notes'
    }
  ]
%>

<%= render 'shared/steps/step_breadcrumb', links: links %>

<%= render 'shared/steps/page_title', links: links %>

<%= render 'shared/steps/heading',
  step_nav: @step_by_step_page.title,
  action: 'Change notes'
%>

<%= render 'nav', step_by_step_page: @step_by_step_page, active: "internal-change-notes" %>

<% displayed_edition_number = nil %>
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <%= form_for(@internal_change_note, url: step_by_step_page_internal_change_notes_path) do |form| %>
      <%= render "shared/steps/form_errors", resource: @step_by_step_page %>

      <%= render "govuk_publishing_components/components/textarea", {
        label: {
          text: "Internal note",
          bold: true
        },
        name: "internal_change_note[description]"
      } %>

      <%= render "govuk_publishing_components/components/button", {
        text: "Add internal note",
        margin_bottom: true
      } %>
    <% end %>

    <% @step_by_step_page.internal_change_notes.each do |entry| %>
      <div class="app-c-timeline-entry">
        <% if displayed_edition_number != entry.edition_number %>
          <h3 class="app-c-timeline-entry__title"><%= "#{entry.edition_number.to_i.ordinalize} edition" %></h3>
          <% displayed_edition_number = entry.edition_number %>
        <% end %>

        <h4 class="app-c-timeline-entry__type">
          <%= "Internal note" %>
        </h4>

        <p class="app-c-timeline-entry__dateline">
          <%= entry.readable_created_date %> by <%= entry.author %>
        </p>

        <div class="app-c-timeline-entry__description">
          <%= entry.description %>
        </div>
      </div>
    <% end %>
  </div>
</div>
